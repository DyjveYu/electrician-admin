import{_ as fe}from"./_plugin-vue_export-helper-BwE83l92.js";/* empty css                  *//* empty css                     *//* empty css                        *//* empty css                             *//* empty css                        *//* empty css                   *//* empty css                 */import{V as T,r as h,a as N,O as ge,c as V,o as p,b as i,d as t,W as ye,w as a,m as be,j as we,X as he,p as ke,Y as Ce,y as $,Z as Ee,_ as xe,s as r,R as Ve,h as I,E as $e,$ as Be,q as o,T as De,t as d,a2 as Z,U as je,B as f,a0 as Te,a1 as ze,a3 as Se,f as Ie,i as Me,N as L}from"./index-By0-w93g.js";const Re=m=>T({url:"/admin/electricians",method:"get",params:m}),Ue=(m,y)=>T({url:`/admin/electricians/${m}/review`,method:"put",data:{status:"approved",...y}}),Ne=(m,y)=>T({url:`/admin/electricians/${m}/review`,method:"put",data:{status:"rejected",reason:y.reason||""}}),Le=m=>T({url:`/admin/electricians/${m}`,method:"get"}),Fe=m=>T({url:`/admin/electricians/${m}/ban`,method:"post"}),qe={class:"electricians-page"},Oe={class:"page-card"},Ae={class:"table-toolbar"},Ke={class:"left"},Pe={class:"right"},We={class:"pagination-wrapper"},Xe={key:0,class:"electrician-detail"},Ye={key:0,class:"photos-section"},Ze={class:"photos-grid"},Ge={key:0,class:"photo-item"},He={key:1,class:"photo-item"},Je={key:2,class:"photo-item"},Qe={class:"dialog-footer"},et={__name:"Electricians",setup(m){const y=h(!1),z=h([]),B=h([]),b=h(!1),D=h(!1),s=h(null),F=h(null),k=N({keyword:"",status:""}),c=N({page:1,limit:20,total:0}),C=N({reason:""}),q=l=>({pending:"warning",approved:"success",rejected:"danger"})[l]||"info",O=l=>({pending:"待审核",approved:"已通过",rejected:"已驳回"})[l]||"未知",E=l=>l?new Date(l).toLocaleDateString("zh-CN"):"",G=l=>l?l.replace(/(\d{6})\d{8}(\d{4})/,"$1********$2"):"",A=l=>{if(!l)return!1;const w=new Date(l)-new Date,j=Math.ceil(w/(1e3*60*60*24));return j<=30&&j>=0},g=async()=>{y.value=!0;try{const l={page:c.page,limit:c.limit,...k},e=await Re(l);e.code===200?(z.value=e.data.list||[],c.total=e.data.total||0):(r.error(e.message||"获取电工列表失败"),z.value=[],c.total=0)}catch(l){console.error("加载电工列表失败:",l),r.error("网络错误，请稍后重试"),z.value=[],c.total=0}finally{y.value=!1}},S=()=>{c.page=1,g()},H=()=>{Object.assign(k,{keyword:"",status:""}),S()},J=l=>{c.limit=l,c.page=1,g()},Q=l=>{c.page=l,g()},ee=l=>{B.value=l},K=async l=>{try{await L.confirm(`确定要通过 ${l.real_name} 的电工认证吗？`,"确认通过",{confirmButtonText:"确定",cancelButtonText:"取消",type:"success"}),(await Ue(l.id,{})).code===200&&(r.success("认证审核通过"),g(),b.value=!1)}catch(e){e!=="cancel"&&(console.error("审核通过失败:",e),r.error("审核通过失败"))}},P=l=>{F.value=l,C.reason="",D.value=!0},te=async()=>{if(!C.reason.trim()){r.warning("请输入驳回原因");return}try{(await Ne(F.value.id,{reason:C.reason})).code===200&&(r.success("认证已驳回"),g(),D.value=!1,b.value=!1)}catch(l){console.error("驳回认证失败:",l),r.error("驳回认证失败")}},ae=async l=>{try{const e=await Le(l.id);e.code===200?s.value=e.data:(r.error(e.message||"获取电工详情失败"),s.value=l),b.value=!0}catch(e){console.error("获取电工详情失败:",e),r.error("网络错误，请稍后重试"),s.value=l,b.value=!0}},le=async l=>{try{await L.confirm(`确定要封禁电工 ${l.real_name} 吗？`,"确认封禁",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),(await Fe(l.id)).code===200&&(r.success("电工封禁成功"),g())}catch(e){e!=="cancel"&&(console.error("封禁电工失败:",e),r.error("封禁电工失败"))}},ne=async()=>{const l=B.value.filter(e=>e.status==="pending");if(l.length===0){r.warning("请选择待审核的电工");return}try{await L.confirm(`确定要批量通过 ${l.length} 个电工的认证吗？`,"确认批量通过",{confirmButtonText:"确定",cancelButtonText:"取消",type:"success"}),r.success("批量审核通过成功"),g()}catch(e){e!=="cancel"&&r.error("批量审核失败")}},se=()=>{if(B.value.filter(e=>e.status==="pending").length===0){r.warning("请选择待审核的电工");return}r.info("批量驳回功能开发中...")};return ge(()=>{g()}),(l,e)=>{const M=I("Search"),w=$e,j=we,R=Be,oe=he,u=ke,re=I("Refresh"),ie=I("Check"),de=I("Close"),_=De,W=je,ce=Ve,ue=Ee,v=ze,pe=Te,U=Se,X=xe,_e=Me,me=Ie,ve=Ce;return p(),V("div",qe,[i("div",Oe,[i("div",Ae,[i("div",Ke,[e[13]||(e[13]=i("h2",null,"电工管理",-1)),t(j,{modelValue:k.keyword,"onUpdate:modelValue":e[0]||(e[0]=n=>k.keyword=n),placeholder:"搜索电工姓名或手机号",style:{width:"300px"},clearable:"",onKeyup:be(S,["enter"])},{prefix:a(()=>[t(w,null,{default:a(()=>[t(M)]),_:1})]),_:1},8,["modelValue"]),t(oe,{modelValue:k.status,"onUpdate:modelValue":e[1]||(e[1]=n=>k.status=n),placeholder:"认证状态",style:{width:"120px"},clearable:"",onChange:S},{default:a(()=>[t(R,{label:"待审核",value:"pending"}),t(R,{label:"已通过",value:"approved"}),t(R,{label:"已驳回",value:"rejected"})]),_:1},8,["modelValue"]),t(u,{type:"primary",onClick:S},{default:a(()=>[t(w,null,{default:a(()=>[t(M)]),_:1}),e[11]||(e[11]=o(" 搜索 ",-1))]),_:1}),t(u,{onClick:H},{default:a(()=>[t(w,null,{default:a(()=>[t(re)]),_:1}),e[12]||(e[12]=o(" 重置 ",-1))]),_:1})]),i("div",Pe,[t(u,{type:"success",onClick:ne,disabled:B.value.length===0},{default:a(()=>[t(w,null,{default:a(()=>[t(ie)]),_:1}),e[14]||(e[14]=o(" 批量通过 ",-1))]),_:1},8,["disabled"]),t(u,{type:"danger",onClick:se,disabled:B.value.length===0},{default:a(()=>[t(w,null,{default:a(()=>[t(de)]),_:1}),e[15]||(e[15]=o(" 批量驳回 ",-1))]),_:1},8,["disabled"])])]),ye((p(),$(ce,{data:z.value,style:{width:"100%"},onSelectionChange:ee},{default:a(()=>[t(_,{type:"selection",width:"55"}),t(_,{prop:"id",label:"ID",width:"80"}),t(_,{prop:"phone",label:"手机号",width:"130"}),t(_,{prop:"real_name",label:"真实姓名",width:"100"}),t(_,{prop:"id_card",label:"身份证号",width:"180"},{default:a(({row:n})=>[i("span",null,d(G(n.id_card)),1)]),_:1}),t(_,{prop:"electrician_license",label:"电工证编号",width:"150"}),t(_,{prop:"license_expiry",label:"证书有效期",width:"120"},{default:a(({row:n})=>[i("span",{class:Z({"text-danger":A(n.license_expiry)})},d(E(n.license_expiry)),3)]),_:1}),t(_,{prop:"status",label:"认证状态",width:"100"},{default:a(({row:n})=>[t(W,{type:q(n.status)},{default:a(()=>[o(d(O(n.status)),1)]),_:2},1032,["type"])]),_:1}),t(_,{prop:"created_at",label:"申请时间",width:"160"},{default:a(({row:n})=>[o(d(E(n.created_at)),1)]),_:1}),t(_,{prop:"approved_at",label:"审核时间",width:"160"},{default:a(({row:n})=>[o(d(n.approved_at?E(n.approved_at):"-"),1)]),_:1}),t(_,{label:"操作",width:"250",fixed:"right"},{default:a(({row:n})=>[n.status==="pending"?(p(),$(u,{key:0,type:"success",size:"small",onClick:x=>K(n)},{default:a(()=>[...e[16]||(e[16]=[o(" 通过 ",-1)])]),_:1},8,["onClick"])):f("",!0),n.status==="pending"?(p(),$(u,{key:1,type:"danger",size:"small",onClick:x=>P(n)},{default:a(()=>[...e[17]||(e[17]=[o(" 驳回 ",-1)])]),_:1},8,["onClick"])):f("",!0),t(u,{type:"primary",size:"small",onClick:x=>ae(n)},{default:a(()=>[...e[18]||(e[18]=[o(" 详情 ",-1)])]),_:1},8,["onClick"]),n.status==="approved"?(p(),$(u,{key:2,type:"warning",size:"small",onClick:x=>le(n)},{default:a(()=>[...e[19]||(e[19]=[o(" 封禁 ",-1)])]),_:1},8,["onClick"])):f("",!0)]),_:1})]),_:1},8,["data"])),[[ve,y.value]]),i("div",We,[t(ue,{"current-page":c.page,"onUpdate:currentPage":e[2]||(e[2]=n=>c.page=n),"page-size":c.limit,"onUpdate:pageSize":e[3]||(e[3]=n=>c.limit=n),total:c.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:J,onCurrentChange:Q},null,8,["current-page","page-size","total"])])]),t(X,{modelValue:b.value,"onUpdate:modelValue":e[7]||(e[7]=n=>b.value=n),title:"电工详情",width:"800px"},{footer:a(()=>{var n,x;return[i("div",Qe,[t(u,{onClick:e[4]||(e[4]=Y=>b.value=!1)},{default:a(()=>[...e[24]||(e[24]=[o("关闭",-1)])]),_:1}),((n=s.value)==null?void 0:n.status)==="pending"?(p(),$(u,{key:0,type:"success",onClick:e[5]||(e[5]=Y=>K(s.value))},{default:a(()=>[...e[25]||(e[25]=[o(" 通过认证 ",-1)])]),_:1})):f("",!0),((x=s.value)==null?void 0:x.status)==="pending"?(p(),$(u,{key:1,type:"danger",onClick:e[6]||(e[6]=Y=>P(s.value))},{default:a(()=>[...e[26]||(e[26]=[o(" 驳回认证 ",-1)])]),_:1})):f("",!0)])]}),default:a(()=>[s.value?(p(),V("div",Xe,[t(pe,{column:2,border:""},{default:a(()=>[t(v,{label:"电工ID"},{default:a(()=>[o(d(s.value.id),1)]),_:1}),t(v,{label:"手机号"},{default:a(()=>[o(d(s.value.phone),1)]),_:1}),t(v,{label:"真实姓名"},{default:a(()=>[o(d(s.value.real_name),1)]),_:1}),t(v,{label:"身份证号"},{default:a(()=>[o(d(s.value.id_card),1)]),_:1}),t(v,{label:"电工证编号"},{default:a(()=>[o(d(s.value.electrician_license),1)]),_:1}),t(v,{label:"证书有效期"},{default:a(()=>[i("span",{class:Z({"text-danger":A(s.value.license_expiry)})},d(E(s.value.license_expiry)),3)]),_:1}),t(v,{label:"认证状态"},{default:a(()=>[t(W,{type:q(s.value.status)},{default:a(()=>[o(d(O(s.value.status)),1)]),_:1},8,["type"])]),_:1}),t(v,{label:"申请时间"},{default:a(()=>[o(d(E(s.value.created_at)),1)]),_:1}),t(v,{label:"审核时间"},{default:a(()=>[o(d(s.value.approved_at?E(s.value.approved_at):"未审核"),1)]),_:1}),t(v,{label:"审核备注",span:2},{default:a(()=>[o(d(s.value.reject_reason||"无"),1)]),_:1})]),_:1}),s.value.id_card_front||s.value.id_card_back||s.value.license_photo?(p(),V("div",Ye,[e[23]||(e[23]=i("h4",null,"证件照片",-1)),i("div",Ze,[s.value.id_card_front?(p(),V("div",Ge,[e[20]||(e[20]=i("p",null,"身份证正面",-1)),t(U,{src:s.value.id_card_front,"preview-src-list":[s.value.id_card_front],fit:"cover",class:"photo"},null,8,["src","preview-src-list"])])):f("",!0),s.value.id_card_back?(p(),V("div",He,[e[21]||(e[21]=i("p",null,"身份证背面",-1)),t(U,{src:s.value.id_card_back,"preview-src-list":[s.value.id_card_back],fit:"cover",class:"photo"},null,8,["src","preview-src-list"])])):f("",!0),s.value.license_photo?(p(),V("div",Je,[e[22]||(e[22]=i("p",null,"电工证照片",-1)),t(U,{src:s.value.license_photo,"preview-src-list":[s.value.license_photo],fit:"cover",class:"photo"},null,8,["src","preview-src-list"])])):f("",!0)])])):f("",!0)])):f("",!0)]),_:1},8,["modelValue"]),t(X,{modelValue:D.value,"onUpdate:modelValue":e[10]||(e[10]=n=>D.value=n),title:"驳回认证",width:"500px"},{footer:a(()=>[t(u,{onClick:e[9]||(e[9]=n=>D.value=!1)},{default:a(()=>[...e[27]||(e[27]=[o("取消",-1)])]),_:1}),t(u,{type:"danger",onClick:te},{default:a(()=>[...e[28]||(e[28]=[o("确认驳回",-1)])]),_:1})]),default:a(()=>[t(me,{model:C,"label-width":"80px"},{default:a(()=>[t(_e,{label:"驳回原因",required:""},{default:a(()=>[t(j,{modelValue:C.reason,"onUpdate:modelValue":e[8]||(e[8]=n=>C.reason=n),type:"textarea",rows:4,placeholder:"请输入驳回原因",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},ct=fe(et,[["__scopeId","data-v-74bcaaa4"]]);export{ct as default};
