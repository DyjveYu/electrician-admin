import{_ as ue}from"./_plugin-vue_export-helper-BwE83l92.js";/* empty css                  *//* empty css                             *//* empty css                 *//* empty css                   *//* empty css                        *//* empty css                     */import{V as h,r as c,a as Y,O as re,c as x,o as M,b as u,d as t,w as s,p as ie,f as de,W as pe,Y as me,y as O,Z as ge,_ as fe,s as w,R as ve,q as o,E as ye,k as ce,a8 as _e,i as be,X as Ve,$ as Me,T as we,U as ke,t as i,B as E,j as Ce,a4 as Te,N as xe}from"./index-By0-w93g.js";function Ee(g){return h({url:"/admin/messages",method:"get",params:g})}function he(g){return h({url:"/admin/messages",method:"post",data:g})}function Ue(g,k){return h({url:`/admin/messages/${g}`,method:"put",data:k})}function De(g){return h({url:`/admin/messages/${g}`,method:"delete"})}const ze={class:"messages-container"},Be={class:"page-header"},Ye={class:"filter-section"},$e={class:"table-section"},qe={class:"pagination-section"},Fe={key:0},Se={key:0},Ne={key:1},Ie={__name:"Messages",setup(g){const k=c(!1),U=c(!1),$=c([]),b=c(!1),D=c(!1),C=c(null),d=c(null),z=c(),f=Y({type:"",status:""}),p=Y({page:1,limit:20,total:0}),r=Y({title:"",content:"",type:"system",priority:"medium",target_users:"all",status:"published",scheduled_at:""}),R={title:[{required:!0,message:"请输入标题",trigger:"blur"}],content:[{required:!0,message:"请输入内容",trigger:"blur"}],type:[{required:!0,message:"请选择类型",trigger:"change"}],priority:[{required:!0,message:"请选择优先级",trigger:"change"}],target_users:[{required:!0,message:"请选择目标用户",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},_=async()=>{try{k.value=!0;const l={page:p.page,limit:p.limit,...f},e=await Ee(l);$.value=e.data.messages,p.total=e.data.total}catch{w.error("获取通知列表失败")}finally{k.value=!1}},L=()=>{f.type="",f.status="",p.page=1,_()},W=l=>{p.limit=l,p.page=1,_()},X=l=>{p.page=l,_()},Z=l=>{d.value=l,D.value=!0},A=l=>{C.value=l,Object.assign(r,{title:l.title,content:l.content,type:l.type,priority:l.priority,target_users:l.target_users,status:l.status,scheduled_at:l.scheduled_at||""}),b.value=!0},G=async()=>{try{await z.value.validate(),U.value=!0,C.value?(await Ue(C.value.id,r),w.success("通知更新成功")):(await he(r),w.success("通知创建成功")),b.value=!1,K(),_()}catch(l){if(l.errors)return;w.error("保存失败")}finally{U.value=!1}},J=async l=>{try{await xe.confirm("确定要删除这条通知吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await De(l.id),w.success("删除成功"),_()}catch(e){if(e==="cancel")return;w.error("删除失败")}},K=()=>{var l;Object.assign(r,{title:"",content:"",type:"system",priority:"medium",target_users:"all",status:"published",scheduled_at:""}),C.value=null,(l=z.value)==null||l.resetFields()},q=l=>({system:"系统通知",activity:"活动通知",maintenance:"维护通知",urgent:"紧急通知"})[l]||l,Q=l=>({system:"",activity:"success",maintenance:"warning",urgent:"danger"})[l]||"",F=l=>({low:"低",medium:"中",high:"高",urgent:"紧急"})[l]||l,ee=l=>({low:"info",medium:"",high:"warning",urgent:"danger"})[l]||"",S=l=>({all:"所有用户",users:"普通用户",electricians:"电工用户"})[l]||l,N=l=>({draft:"草稿",published:"已发布",scheduled:"定时发布"})[l]||l,te=l=>({draft:"info",published:"success",scheduled:"warning"})[l]||"",T=l=>l?new Date(l).toLocaleString("zh-CN"):"-";return re(()=>{_()}),(l,e)=>{const le=ye,v=ie,n=Me,V=Ve,m=be,I=de,y=we,B=ke,ae=ve,se=ge,P=Ce,oe=Te,j=fe,ne=me;return M(),x("div",ze,[u("div",Be,[e[16]||(e[16]=u("h2",null,"系统通知管理",-1)),t(v,{type:"primary",onClick:e[0]||(e[0]=a=>b.value=!0)},{default:s(()=>[t(le,null,{default:s(()=>[t(ce(_e))]),_:1}),e[15]||(e[15]=o(" 发布通知 ",-1))]),_:1})]),u("div",Ye,[t(I,{model:f,inline:""},{default:s(()=>[t(m,{label:"通知类型"},{default:s(()=>[t(V,{modelValue:f.type,"onUpdate:modelValue":e[1]||(e[1]=a=>f.type=a),placeholder:"请选择类型",clearable:""},{default:s(()=>[t(n,{label:"系统通知",value:"system"}),t(n,{label:"活动通知",value:"activity"}),t(n,{label:"维护通知",value:"maintenance"}),t(n,{label:"紧急通知",value:"urgent"})]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"状态"},{default:s(()=>[t(V,{modelValue:f.status,"onUpdate:modelValue":e[2]||(e[2]=a=>f.status=a),placeholder:"请选择状态",clearable:""},{default:s(()=>[t(n,{label:"草稿",value:"draft"}),t(n,{label:"已发布",value:"published"}),t(n,{label:"定时发布",value:"scheduled"})]),_:1},8,["modelValue"])]),_:1}),t(m,null,{default:s(()=>[t(v,{type:"primary",onClick:_},{default:s(()=>[...e[17]||(e[17]=[o("查询",-1)])]),_:1}),t(v,{onClick:L},{default:s(()=>[...e[18]||(e[18]=[o("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),u("div",$e,[pe((M(),O(ae,{data:$.value,stripe:""},{default:s(()=>[t(y,{prop:"id",label:"ID",width:"80"}),t(y,{prop:"title",label:"标题","min-width":"200"}),t(y,{prop:"type",label:"类型",width:"120"},{default:s(({row:a})=>[t(B,{type:Q(a.type)},{default:s(()=>[o(i(q(a.type)),1)]),_:2},1032,["type"])]),_:1}),t(y,{prop:"priority",label:"优先级",width:"100"},{default:s(({row:a})=>[t(B,{type:ee(a.priority)},{default:s(()=>[o(i(F(a.priority)),1)]),_:2},1032,["type"])]),_:1}),t(y,{prop:"target_users",label:"目标用户",width:"120"},{default:s(({row:a})=>[o(i(S(a.target_users)),1)]),_:1}),t(y,{prop:"status",label:"状态",width:"100"},{default:s(({row:a})=>[t(B,{type:te(a.status)},{default:s(()=>[o(i(N(a.status)),1)]),_:2},1032,["type"])]),_:1}),t(y,{prop:"created_at",label:"创建时间",width:"180"},{default:s(({row:a})=>[o(i(T(a.created_at)),1)]),_:1}),t(y,{label:"操作",width:"200",fixed:"right"},{default:s(({row:a})=>[t(v,{size:"small",onClick:H=>Z(a)},{default:s(()=>[...e[19]||(e[19]=[o("查看",-1)])]),_:1},8,["onClick"]),t(v,{size:"small",type:"primary",onClick:H=>A(a)},{default:s(()=>[...e[20]||(e[20]=[o("编辑",-1)])]),_:1},8,["onClick"]),t(v,{size:"small",type:"danger",onClick:H=>J(a)},{default:s(()=>[...e[21]||(e[21]=[o("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ne,k.value]]),u("div",qe,[t(se,{"current-page":p.page,"onUpdate:currentPage":e[3]||(e[3]=a=>p.page=a),"page-size":p.limit,"onUpdate:pageSize":e[4]||(e[4]=a=>p.limit=a),"page-sizes":[10,20,50,100],total:p.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:W,onCurrentChange:X},null,8,["current-page","page-size","total"])])]),t(j,{modelValue:b.value,"onUpdate:modelValue":e[13]||(e[13]=a=>b.value=a),title:C.value?"编辑通知":"发布通知",width:"600px"},{footer:s(()=>[t(v,{onClick:e[12]||(e[12]=a=>b.value=!1)},{default:s(()=>[...e[22]||(e[22]=[o("取消",-1)])]),_:1}),t(v,{type:"primary",onClick:G,loading:U.value},{default:s(()=>[...e[23]||(e[23]=[o("保存",-1)])]),_:1},8,["loading"])]),default:s(()=>[t(I,{model:r,rules:R,ref_key:"messageFormRef",ref:z,"label-width":"100px"},{default:s(()=>[t(m,{label:"标题",prop:"title"},{default:s(()=>[t(P,{modelValue:r.title,"onUpdate:modelValue":e[5]||(e[5]=a=>r.title=a),placeholder:"请输入通知标题"},null,8,["modelValue"])]),_:1}),t(m,{label:"内容",prop:"content"},{default:s(()=>[t(P,{modelValue:r.content,"onUpdate:modelValue":e[6]||(e[6]=a=>r.content=a),type:"textarea",rows:4,placeholder:"请输入通知内容"},null,8,["modelValue"])]),_:1}),t(m,{label:"类型",prop:"type"},{default:s(()=>[t(V,{modelValue:r.type,"onUpdate:modelValue":e[7]||(e[7]=a=>r.type=a),placeholder:"请选择类型"},{default:s(()=>[t(n,{label:"系统通知",value:"system"}),t(n,{label:"活动通知",value:"activity"}),t(n,{label:"维护通知",value:"maintenance"}),t(n,{label:"紧急通知",value:"urgent"})]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"优先级",prop:"priority"},{default:s(()=>[t(V,{modelValue:r.priority,"onUpdate:modelValue":e[8]||(e[8]=a=>r.priority=a),placeholder:"请选择优先级"},{default:s(()=>[t(n,{label:"低",value:"low"}),t(n,{label:"中",value:"medium"}),t(n,{label:"高",value:"high"}),t(n,{label:"紧急",value:"urgent"})]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"目标用户",prop:"target_users"},{default:s(()=>[t(V,{modelValue:r.target_users,"onUpdate:modelValue":e[9]||(e[9]=a=>r.target_users=a),placeholder:"请选择目标用户"},{default:s(()=>[t(n,{label:"所有用户",value:"all"}),t(n,{label:"普通用户",value:"users"}),t(n,{label:"电工用户",value:"electricians"})]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"状态",prop:"status"},{default:s(()=>[t(V,{modelValue:r.status,"onUpdate:modelValue":e[10]||(e[10]=a=>r.status=a),placeholder:"请选择状态"},{default:s(()=>[t(n,{label:"草稿",value:"draft"}),t(n,{label:"立即发布",value:"published"}),t(n,{label:"定时发布",value:"scheduled"})]),_:1},8,["modelValue"])]),_:1}),r.status==="scheduled"?(M(),O(m,{key:0,label:"发布时间",prop:"scheduled_at"},{default:s(()=>[t(oe,{modelValue:r.scheduled_at,"onUpdate:modelValue":e[11]||(e[11]=a=>r.scheduled_at=a),type:"datetime",placeholder:"选择发布时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1})):E("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(j,{modelValue:D.value,"onUpdate:modelValue":e[14]||(e[14]=a=>D.value=a),title:"通知详情",width:"500px"},{default:s(()=>[d.value?(M(),x("div",Fe,[u("p",null,[e[24]||(e[24]=u("strong",null,"标题：",-1)),o(i(d.value.title),1)]),u("p",null,[e[25]||(e[25]=u("strong",null,"内容：",-1)),o(i(d.value.content),1)]),u("p",null,[e[26]||(e[26]=u("strong",null,"类型：",-1)),o(i(q(d.value.type)),1)]),u("p",null,[e[27]||(e[27]=u("strong",null,"优先级：",-1)),o(i(F(d.value.priority)),1)]),u("p",null,[e[28]||(e[28]=u("strong",null,"目标用户：",-1)),o(i(S(d.value.target_users)),1)]),u("p",null,[e[29]||(e[29]=u("strong",null,"状态：",-1)),o(i(N(d.value.status)),1)]),u("p",null,[e[30]||(e[30]=u("strong",null,"创建时间：",-1)),o(i(T(d.value.created_at)),1)]),d.value.published_at?(M(),x("p",Se,[e[31]||(e[31]=u("strong",null,"发布时间：",-1)),o(i(T(d.value.published_at)),1)])):E("",!0),d.value.scheduled_at?(M(),x("p",Ne,[e[32]||(e[32]=u("strong",null,"定时发布：",-1)),o(i(T(d.value.scheduled_at)),1)])):E("",!0)])):E("",!0)]),_:1},8,["modelValue"])])}}},Ze=ue(Ie,[["__scopeId","data-v-21269352"]]);export{Ze as default};
