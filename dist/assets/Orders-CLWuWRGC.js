import{_ as _e}from"./_plugin-vue_export-helper-BwE83l92.js";/* empty css                  *//* empty css                        *//* empty css                             *//* empty css                        *//* empty css                   *//* empty css                 *//* empty css                         */import{a as me,b as fe,u as $}from"./orders-DfnfWRpw.js";/* empty css                             */import{r as V,a as I,O as ge,c as m,o as u,b as d,d as e,W as ve,w as a,m as be,j as we,X as ye,a4 as he,p as ke,Q as Ce,Y as Ee,y as S,Z as xe,_ as Ve,s as g,R as Se,h as R,E as De,$ as Oe,q as s,S as Re,t as r,T as Te,U as Be,I as ze,K as Ie,B as v,L as Me,a0 as Ue,a1 as Le,a5 as Ne,a6 as Pe,a3 as $e,a7 as je,N as j}from"./index-By0-w93g.js";const Fe={class:"orders-page"},Ke={class:"page-card"},qe={class:"table-toolbar"},Ae={class:"left"},Qe={class:"right"},We={class:"stat-card"},Xe={class:"stat-number"},Ye={class:"stat-card"},Ze={class:"stat-number"},Ge={class:"stat-card"},He={class:"stat-number"},Je={class:"stat-card"},et={class:"stat-number"},tt={key:0},at={key:1,class:"text-muted"},lt={class:"pagination-wrapper"},nt={key:0,class:"order-detail"},ot={key:0},st={key:1,class:"text-muted"},rt={key:0,class:"images-section"},dt={class:"images-grid"},it={key:1,class:"repair-section"},ut={key:2,class:"review-section"},pt={__name:"Orders",setup(ct){const T=V(!1),B=V([]),F=V([]),h=V(!1),n=V(null),p=I({keyword:"",status:"",dateRange:null}),c=I({page:1,limit:20,total:0}),k=I({total:0,pending:0,inProgress:0,completed:0}),M=o=>({pending:"warning",in_progress:"primary",pending_payment:"info",completed:"success",cancelled:"danger"})[o]||"info",U=o=>({pending:"待接单",in_progress:"进行中",pending_payment:"待支付",completed:"已完成",cancelled:"已取消"})[o]||"未知",f=o=>o?new Date(o).toLocaleString("zh-CN"):"",b=async()=>{T.value=!0;try{const o={page:c.page,limit:c.limit,search:p.keyword,status:p.status};p.dateRange&&p.dateRange.length===2&&(o.start_date=p.dateRange[0].toISOString().split("T")[0],o.end_date=p.dateRange[1].toISOString().split("T")[0]);const t=await me(o);t.code===200&&(B.value=t.data.orders,c.total=t.data.total,Object.assign(k,t.data.stats||{}))}catch(o){console.error("加载工单列表失败:",o),g.error("加载工单列表失败: "+o.message),B.value=[]}finally{T.value=!1}},C=()=>{c.page=1,b()},K=()=>{Object.assign(p,{keyword:"",status:"",dateRange:null}),C()},q=o=>{c.limit=o,c.page=1,b()},A=o=>{c.page=o,b()},Q=o=>{F.value=o},W=async o=>{try{const t=await fe(o.id);t.code===200?n.value=t.data:n.value=o,h.value=!0}catch(t){console.error("获取工单详情失败:",t),n.value=o,h.value=!0}},X=async(o,t)=>{switch(o){case"cancel":await Y(t);break;case"force_complete":await Z(t);break;case"refund":await G();break}},Y=async o=>{try{await j.confirm(`确定要取消工单 ${o.order_number} 吗？`,"确认取消",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),(await $(o.id,{status:"cancelled"})).code===200&&(g.success("工单已取消"),b())}catch(t){t!=="cancel"&&(console.error("取消工单失败:",t),g.error("取消工单失败"))}},Z=async o=>{try{await j.confirm(`确定要强制完成工单 ${o.order_number} 吗？`,"确认强制完成",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),(await $(o.id,{status:"completed"})).code===200&&(g.success("工单已强制完成"),b())}catch(t){t!=="cancel"&&(console.error("强制完成工单失败:",t),g.error("强制完成工单失败"))}},G=async o=>{g.info("退款功能开发中...")},H=()=>{g.info("导出功能开发中...")};return ge(()=>{b()}),(o,t)=>{const L=R("Search"),E=De,J=we,x=Oe,ee=ye,te=he,w=ke,ae=R("Refresh"),le=R("Download"),y=Re,N=Ce,_=Te,P=Be,ne=R("arrow-down"),z=Me,oe=Ie,se=ze,re=Se,de=xe,i=Le,D=Ue,ie=$e,ue=je,pe=Ve,ce=Ee;return u(),m("div",Fe,[d("div",Ke,[d("div",qe,[d("div",Ae,[t[10]||(t[10]=d("h2",null,"工单管理",-1)),e(J,{modelValue:p.keyword,"onUpdate:modelValue":t[0]||(t[0]=l=>p.keyword=l),placeholder:"搜索工单号或用户手机号",style:{width:"300px"},clearable:"",onKeyup:be(C,["enter"])},{prefix:a(()=>[e(E,null,{default:a(()=>[e(L)]),_:1})]),_:1},8,["modelValue"]),e(ee,{modelValue:p.status,"onUpdate:modelValue":t[1]||(t[1]=l=>p.status=l),placeholder:"工单状态",style:{width:"120px"},clearable:"",onChange:C},{default:a(()=>[e(x,{label:"待接单",value:"pending"}),e(x,{label:"进行中",value:"in_progress"}),e(x,{label:"待支付",value:"pending_payment"}),e(x,{label:"已完成",value:"completed"}),e(x,{label:"已取消",value:"cancelled"})]),_:1},8,["modelValue"]),e(te,{modelValue:p.dateRange,"onUpdate:modelValue":t[2]||(t[2]=l=>p.dateRange=l),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"240px"},onChange:C},null,8,["modelValue"]),e(w,{type:"primary",onClick:C},{default:a(()=>[e(E,null,{default:a(()=>[e(L)]),_:1}),t[8]||(t[8]=s(" 搜索 ",-1))]),_:1}),e(w,{onClick:K},{default:a(()=>[e(E,null,{default:a(()=>[e(ae)]),_:1}),t[9]||(t[9]=s(" 重置 ",-1))]),_:1})]),d("div",Qe,[e(w,{type:"success",onClick:H},{default:a(()=>[e(E,null,{default:a(()=>[e(le)]),_:1}),t[11]||(t[11]=s(" 导出数据 ",-1))]),_:1})])]),e(N,{gutter:16,class:"stats-row"},{default:a(()=>[e(y,{span:6},{default:a(()=>[d("div",We,[d("div",Xe,r(k.total),1),t[12]||(t[12]=d("div",{class:"stat-label"},"总工单数",-1))])]),_:1}),e(y,{span:6},{default:a(()=>[d("div",Ye,[d("div",Ze,r(k.pending),1),t[13]||(t[13]=d("div",{class:"stat-label"},"待接单",-1))])]),_:1}),e(y,{span:6},{default:a(()=>[d("div",Ge,[d("div",He,r(k.inProgress),1),t[14]||(t[14]=d("div",{class:"stat-label"},"进行中",-1))])]),_:1}),e(y,{span:6},{default:a(()=>[d("div",Je,[d("div",et,r(k.completed),1),t[15]||(t[15]=d("div",{class:"stat-label"},"已完成",-1))])]),_:1})]),_:1}),ve((u(),S(re,{data:B.value,style:{width:"100%"},onSelectionChange:Q},{default:a(()=>[e(_,{type:"selection",width:"55"}),e(_,{prop:"order_no",label:"工单号",width:"150"}),e(_,{prop:"user_nickname",label:"用户昵称",width:"130"}),e(_,{prop:"electrician_nickname",label:"电工",width:"100"},{default:a(({row:l})=>[d("span",null,r(l.electrician_nickname||"未分配"),1)]),_:1}),e(_,{prop:"service_type_name",label:"服务类型",width:"120"}),e(_,{label:"问题描述",width:"200","show-overflow-tooltip":""},{default:a(({row:l})=>[d("span",null,r(l.title||"-"),1)]),_:1}),e(_,{label:"服务地址",width:"200","show-overflow-tooltip":""},{default:a(({row:l})=>[d("span",null,r(l.service_address||"-"),1)]),_:1}),e(_,{prop:"final_amount",label:"金额",width:"100"},{default:a(({row:l})=>[l.final_amount?(u(),m("span",tt,"¥"+r(l.final_amount),1)):(u(),m("span",at,"未报价"))]),_:1}),e(_,{prop:"status",label:"状态",width:"100"},{default:a(({row:l})=>[e(P,{type:M(l.status)},{default:a(()=>[s(r(U(l.status)),1)]),_:2},1032,["type"])]),_:1}),e(_,{prop:"created_at",label:"创建时间",width:"160"},{default:a(({row:l})=>[s(r(f(l.created_at)),1)]),_:1}),e(_,{prop:"completed_at",label:"完成时间",width:"160"},{default:a(({row:l})=>[s(r(l.completed_at?f(l.completed_at):"-"),1)]),_:1}),e(_,{label:"操作",width:"200",fixed:"right"},{default:a(({row:l})=>[e(w,{type:"primary",size:"small",onClick:O=>W(l)},{default:a(()=>[...t[16]||(t[16]=[s(" 详情 ",-1)])]),_:1},8,["onClick"]),e(se,{onCommand:O=>X(O,l)},{dropdown:a(()=>[e(oe,null,{default:a(()=>[l.status==="pending"||l.status==="in_progress"?(u(),S(z,{key:0,command:"cancel"},{default:a(()=>[...t[18]||(t[18]=[s(" 取消工单 ",-1)])]),_:1})):v("",!0),l.status==="in_progress"?(u(),S(z,{key:1,command:"force_complete"},{default:a(()=>[...t[19]||(t[19]=[s(" 强制完成 ",-1)])]),_:1})):v("",!0),l.status==="completed"?(u(),S(z,{key:2,command:"refund"},{default:a(()=>[...t[20]||(t[20]=[s(" 申请退款 ",-1)])]),_:1})):v("",!0)]),_:2},1024)]),default:a(()=>[e(w,{type:"text",size:"small"},{default:a(()=>[t[17]||(t[17]=s(" 更多",-1)),e(E,{class:"el-icon--right"},{default:a(()=>[e(ne)]),_:1})]),_:1})]),_:2},1032,["onCommand"])]),_:1})]),_:1},8,["data"])),[[ce,T.value]]),d("div",lt,[e(de,{"current-page":c.page,"onUpdate:currentPage":t[3]||(t[3]=l=>c.page=l),"page-size":c.limit,"onUpdate:pageSize":t[4]||(t[4]=l=>c.limit=l),total:c.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:q,onCurrentChange:A},null,8,["current-page","page-size","total"])])]),e(pe,{modelValue:h.value,"onUpdate:modelValue":t[7]||(t[7]=l=>h.value=l),title:"工单详情",width:"900px"},{footer:a(()=>[e(w,{onClick:t[6]||(t[6]=l=>h.value=!1)},{default:a(()=>[...t[24]||(t[24]=[s("关闭",-1)])]),_:1})]),default:a(()=>[n.value?(u(),m("div",nt,[e(N,{gutter:24},{default:a(()=>[e(y,{span:12},{default:a(()=>[e(D,{title:"基本信息",column:1,border:""},{default:a(()=>[e(i,{label:"工单号"},{default:a(()=>[s(r(n.value.order_number),1)]),_:1}),e(i,{label:"服务类型"},{default:a(()=>[s(r(n.value.service_type),1)]),_:1}),e(i,{label:"问题描述"},{default:a(()=>[s(r(n.value.description),1)]),_:1}),e(i,{label:"服务地址"},{default:a(()=>[s(r(n.value.address),1)]),_:1}),e(i,{label:"联系人"},{default:a(()=>[s(r(n.value.contact_name),1)]),_:1}),e(i,{label:"联系电话"},{default:a(()=>[s(r(n.value.contact_phone),1)]),_:1}),e(i,{label:"预约时间"},{default:a(()=>[s(r(n.value.appointment_time?f(n.value.appointment_time):"随时"),1)]),_:1})]),_:1})]),_:1}),e(y,{span:12},{default:a(()=>[e(D,{title:"状态信息",column:1,border:""},{default:a(()=>[e(i,{label:"当前状态"},{default:a(()=>[e(P,{type:M(n.value.status)},{default:a(()=>[s(r(U(n.value.status)),1)]),_:1},8,["type"])]),_:1}),e(i,{label:"用户"},{default:a(()=>[s(r(n.value.user_phone),1)]),_:1}),e(i,{label:"电工"},{default:a(()=>[s(r(n.value.electrician_name||"未分配"),1)]),_:1}),e(i,{label:"报价金额"},{default:a(()=>[n.value.amount?(u(),m("span",ot,"¥"+r(n.value.amount),1)):(u(),m("span",st,"未报价"))]),_:1}),e(i,{label:"创建时间"},{default:a(()=>[s(r(f(n.value.created_at)),1)]),_:1}),e(i,{label:"接单时间"},{default:a(()=>[s(r(n.value.accepted_at?f(n.value.accepted_at):"-"),1)]),_:1}),e(i,{label:"完成时间"},{default:a(()=>[s(r(n.value.completed_at?f(n.value.completed_at):"-"),1)]),_:1})]),_:1})]),_:1})]),_:1}),n.value.images&&n.value.images.length>0?(u(),m("div",rt,[t[21]||(t[21]=d("h4",null,"问题图片",-1)),d("div",dt,[(u(!0),m(Ne,null,Pe(n.value.images,(l,O)=>(u(),S(ie,{key:O,src:l,"preview-src-list":n.value.images,fit:"cover",class:"order-image"},null,8,["src","preview-src-list"]))),128))])])):v("",!0),n.value.repair_description?(u(),m("div",it,[t[22]||(t[22]=d("h4",null,"维修记录",-1)),e(D,{column:1,border:""},{default:a(()=>[e(i,{label:"维修内容"},{default:a(()=>[s(r(n.value.repair_description),1)]),_:1}),e(i,{label:"维修时间"},{default:a(()=>[s(r(n.value.repair_time?f(n.value.repair_time):"-"),1)]),_:1}),e(i,{label:"维修费用"},{default:a(()=>[s("¥"+r(n.value.repair_amount||0),1)]),_:1})]),_:1})])):v("",!0),n.value.review?(u(),m("div",ut,[t[23]||(t[23]=d("h4",null,"用户评价",-1)),e(D,{column:1,border:""},{default:a(()=>[e(i,{label:"评分"},{default:a(()=>[e(ue,{modelValue:n.value.review.rating,"onUpdate:modelValue":t[5]||(t[5]=l=>n.value.review.rating=l),disabled:""},null,8,["modelValue"])]),_:1}),e(i,{label:"评价内容"},{default:a(()=>[s(r(n.value.review.content),1)]),_:1}),e(i,{label:"评价时间"},{default:a(()=>[s(r(f(n.value.review.created_at)),1)]),_:1})]),_:1})])):v("",!0)])):v("",!0)]),_:1},8,["modelValue"])])}}},Et=_e(pt,[["__scopeId","data-v-43e2c3be"]]);export{Et as default};
