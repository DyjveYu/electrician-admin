import{_ as te}from"./_plugin-vue_export-helper-BwE83l92.js";/* empty css                  *//* empty css                             *//* empty css                        *//* empty css                   *//* empty css                 */import{V as U,r as b,a as I,O as ae,c as N,o as h,b as m,d as t,W as le,w as a,m as ne,j as oe,X as se,p as re,Y as ie,y as T,Z as ce,_ as ue,R as de,h as D,E as pe,$ as _e,q as o,T as me,t as r,U as fe,B as ge,a0 as ve,a1 as ye,N as L,s as w}from"./index-By0-w93g.js";const be=u=>U({url:"/admin/users",method:"get",params:u}),he=u=>U({url:`/admin/users/${u}/ban`,method:"post"}),we=u=>U({url:`/admin/users/${u}/unban`,method:"post"}),ke=u=>U({url:`/admin/users/${u}`,method:"get"}),Ce={class:"users-page"},xe={class:"page-card"},Ue={class:"table-toolbar"},Ve={class:"left"},Ee={class:"right"},Te={class:"pagination-wrapper"},De={key:0,class:"user-detail"},Be={__name:"Users",setup(u){const V=b(!1),E=b([]),Z=b([]),v=b(!1),s=b(null),d=I({keyword:"",status:"",role:""}),i=I({page:1,limit:20,total:0}),B=n=>({active:"success",banned:"danger",inactive:"warning"})[n]||"info",S=n=>({active:"正常",banned:"封禁",inactive:"未激活"})[n]||"未知",k=n=>n?new Date(n).toLocaleString("zh-CN"):"",f=async()=>{V.value=!0;try{const n={page:i.page,limit:i.limit,...d},e=await be(n);e.code===200&&(E.value=e.data.users||e.data.list||[],i.total=e.data.total)}catch(n){console.error("加载用户列表失败:",n),E.value=[{id:1,phone:"13800138000",nickname:"测试用户1",current_role:"user",can_be_electrician:!1,status:"active",created_at:"2024-01-01T00:00:00Z",last_login_at:"2024-01-15T10:30:00Z"},{id:2,phone:"13900139000",nickname:"张师傅",current_role:"electrician",can_be_electrician:!0,status:"active",created_at:"2024-01-02T00:00:00Z",last_login_at:"2024-01-15T09:15:00Z"}],i.total=2}finally{V.value=!1}},y=()=>{i.page=1,f()},R=()=>{Object.assign(d,{keyword:"",status:"",role:""}),y()},j=n=>{i.limit=n,i.page=1,f()},O=n=>{i.page=n,f()},q=n=>{Z.value=n},K=async n=>{try{await L.confirm(`确定要封禁用户 ${n.phone} 吗？`,"确认封禁",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),(await he(n.id)).code===200&&(w.success("用户封禁成功"),f())}catch(e){e!=="cancel"&&(console.error("封禁用户失败:",e),w.error("封禁用户失败"))}},P=async n=>{try{await L.confirm(`确定要解封用户 ${n.phone} 吗？`,"确认解封",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),(await we(n.id)).code===200&&(w.success("用户解封成功"),f())}catch(e){e!=="cancel"&&(console.error("解封用户失败:",e),w.error("解封用户失败"))}},F=async n=>{try{const e=await ke(n.id);e.code===200?s.value=e.data:s.value=n,v.value=!0}catch(e){console.error("获取用户详情失败:",e),s.value=n,v.value=!0}},W=()=>{w.info("导出功能开发中...")};return ae(()=>{f()}),(n,e)=>{const z=D("Search"),C=pe,X=oe,x=_e,$=se,_=re,Y=D("Refresh"),A=D("Download"),c=me,g=fe,G=de,H=ce,p=ye,J=ve,Q=ue,ee=ie;return h(),N("div",Ce,[m("div",xe,[m("div",Ue,[m("div",Ve,[e[9]||(e[9]=m("h2",null,"用户管理",-1)),t(X,{modelValue:d.keyword,"onUpdate:modelValue":e[0]||(e[0]=l=>d.keyword=l),placeholder:"搜索用户手机号或昵称",style:{width:"300px"},clearable:"",onKeyup:ne(y,["enter"])},{prefix:a(()=>[t(C,null,{default:a(()=>[t(z)]),_:1})]),_:1},8,["modelValue"]),t($,{modelValue:d.status,"onUpdate:modelValue":e[1]||(e[1]=l=>d.status=l),placeholder:"用户状态",style:{width:"120px"},clearable:"",onChange:y},{default:a(()=>[t(x,{label:"正常",value:"active"}),t(x,{label:"封禁",value:"banned"})]),_:1},8,["modelValue"]),t($,{modelValue:d.role,"onUpdate:modelValue":e[2]||(e[2]=l=>d.role=l),placeholder:"用户角色",style:{width:"120px"},clearable:"",onChange:y},{default:a(()=>[t(x,{label:"普通用户",value:"user"}),t(x,{label:"电工",value:"electrician"})]),_:1},8,["modelValue"]),t(_,{type:"primary",onClick:y},{default:a(()=>[t(C,null,{default:a(()=>[t(z)]),_:1}),e[7]||(e[7]=o(" 搜索 ",-1))]),_:1}),t(_,{onClick:R},{default:a(()=>[t(C,null,{default:a(()=>[t(Y)]),_:1}),e[8]||(e[8]=o(" 重置 ",-1))]),_:1})]),m("div",Ee,[t(_,{type:"primary",onClick:W},{default:a(()=>[t(C,null,{default:a(()=>[t(A)]),_:1}),e[10]||(e[10]=o(" 导出数据 ",-1))]),_:1})])]),le((h(),T(G,{data:E.value,style:{width:"100%"},onSelectionChange:q},{default:a(()=>[t(c,{type:"selection",width:"55"}),t(c,{prop:"id",label:"ID",width:"80"}),t(c,{prop:"phone",label:"手机号",width:"130"}),t(c,{prop:"nickname",label:"昵称",width:"120"},{default:a(({row:l})=>[m("span",null,r(l.nickname||"未设置"),1)]),_:1}),t(c,{prop:"current_role",label:"当前角色",width:"100"},{default:a(({row:l})=>[t(g,{type:l.current_role==="electrician"?"warning":"primary"},{default:a(()=>[o(r(l.current_role==="electrician"?"电工":"用户"),1)]),_:2},1032,["type"])]),_:1}),t(c,{prop:"can_be_electrician",label:"电工认证",width:"100"},{default:a(({row:l})=>[t(g,{type:l.can_be_electrician?"success":"info"},{default:a(()=>[o(r(l.can_be_electrician?"已认证":"未认证"),1)]),_:2},1032,["type"])]),_:1}),t(c,{prop:"status",label:"状态",width:"80"},{default:a(({row:l})=>[t(g,{type:B(l.status)},{default:a(()=>[o(r(S(l.status)),1)]),_:2},1032,["type"])]),_:1}),t(c,{prop:"created_at",label:"注册时间",width:"160"},{default:a(({row:l})=>[o(r(k(l.created_at)),1)]),_:1}),t(c,{prop:"last_login_at",label:"最后登录",width:"160"},{default:a(({row:l})=>[o(r(l.last_login_at?k(l.last_login_at):"从未登录"),1)]),_:1}),t(c,{label:"操作",width:"200",fixed:"right"},{default:a(({row:l})=>[l.status==="active"?(h(),T(_,{key:0,type:"danger",size:"small",onClick:M=>K(l)},{default:a(()=>[...e[11]||(e[11]=[o(" 封禁 ",-1)])]),_:1},8,["onClick"])):(h(),T(_,{key:1,type:"success",size:"small",onClick:M=>P(l)},{default:a(()=>[...e[12]||(e[12]=[o(" 解封 ",-1)])]),_:1},8,["onClick"])),t(_,{type:"primary",size:"small",onClick:M=>F(l)},{default:a(()=>[...e[13]||(e[13]=[o(" 详情 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ee,V.value]]),m("div",Te,[t(H,{"current-page":i.page,"onUpdate:currentPage":e[3]||(e[3]=l=>i.page=l),"page-size":i.limit,"onUpdate:pageSize":e[4]||(e[4]=l=>i.limit=l),total:i.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:j,onCurrentChange:O},null,8,["current-page","page-size","total"])])]),t(Q,{modelValue:v.value,"onUpdate:modelValue":e[6]||(e[6]=l=>v.value=l),title:"用户详情",width:"600px"},{footer:a(()=>[t(_,{onClick:e[5]||(e[5]=l=>v.value=!1)},{default:a(()=>[...e[14]||(e[14]=[o("关闭",-1)])]),_:1})]),default:a(()=>[s.value?(h(),N("div",De,[t(J,{column:2,border:""},{default:a(()=>[t(p,{label:"用户ID"},{default:a(()=>[o(r(s.value.id),1)]),_:1}),t(p,{label:"手机号"},{default:a(()=>[o(r(s.value.phone),1)]),_:1}),t(p,{label:"昵称"},{default:a(()=>[o(r(s.value.nickname||"未设置"),1)]),_:1}),t(p,{label:"当前角色"},{default:a(()=>[t(g,{type:s.value.current_role==="electrician"?"warning":"primary"},{default:a(()=>[o(r(s.value.current_role==="electrician"?"电工":"用户"),1)]),_:1},8,["type"])]),_:1}),t(p,{label:"电工认证"},{default:a(()=>[t(g,{type:s.value.can_be_electrician?"success":"info"},{default:a(()=>[o(r(s.value.can_be_electrician?"已认证":"未认证"),1)]),_:1},8,["type"])]),_:1}),t(p,{label:"状态"},{default:a(()=>[t(g,{type:B(s.value.status)},{default:a(()=>[o(r(S(s.value.status)),1)]),_:1},8,["type"])]),_:1}),t(p,{label:"注册时间"},{default:a(()=>[o(r(k(s.value.created_at)),1)]),_:1}),t(p,{label:"最后登录"},{default:a(()=>[o(r(s.value.last_login_at?k(s.value.last_login_at):"从未登录"),1)]),_:1})]),_:1})])):ge("",!0)]),_:1},8,["modelValue"])])}}},Ze=te(Be,[["__scopeId","data-v-0e4890db"]]);export{Ze as default};
